\chapter{Introduction}


% \emph{}

\section{Problem Statement and Approach}

Data undeniably plays a critical role in driving companies, especially in rapidly evolving business environments. Data offers insights that can solve problems, lead to improvements, help in making informed decisions, understand customer preferences, enhance marketing strategies, reduce costs, manage risks, and much more. Relying solely on specialists to retrieve data efficiently can be costly and time-consuming. Therefore, creating a query support tool that assists users in retrieving data from databases efficiently would be highly beneficial for fast-growing travel technology companies like Agoda.

At Agoda, the majority of employees are non-IT employees, which poses a challenge when retrieving important data. These employees often need to construct query statements, leading to inefficiencies in their workflow. They must either invest time in learning SQL or wait for the support team to respond to their query-related tickets, which can delay decision-making and reduce overall productivity.

This project aims to simplify data access and enhance productivity by enabling employees, especially non-technical users, to retrieve information without requiring SQL expertise. The Query Assistance tool leverages advanced technologies, including Large Language Models (LLMs) and LangChain, to provide comprehensive query support. It can fix incorrect queries, optimize performance, convert database syntax, and generate SQL statements from natural language input.

Initially, the tool will be developed as an API platform, allowing integration with various systems. In its later phase, it will be embedded into Superset to assist users directly within SQL Lab, streamlining workflows and reducing dependence on support teams. The integration with OpenMetadata enhances its capabilities, enabling the tool to analyze metadata and intelligently select the appropriate tables and columns for query construction. By combining these features, the Query Assistance tool addresses inefficiencies in query handling, helping organizations like Agoda save time, reduce costs, and improve decision-making processes.

\section{Objectives}
1.2.1 	To enhance correctness and increase efficiency in construction of queries.

1.2.2 	To develop API endpoints leveraging LLM services capable of fixing, converting, optimizing, and constructing queries.

1.2.3	To integrate Query Assistance with Agoda's existing services and tools, such as Superset and Slack,

\pagebreak
\section{Scope of Work}
1.3.1	The API service to help solving SQL queries statement problems.

1.3.2	Develop capabilities for error handling in queries, ensuring syntax accuracy across multiple databases and correcting column and table names.

1.3.3	Implement query optimization techniques, utilizing partition columns to enhance performance and reduce both memory consumption and query execution time.

1.3.4	Build a module for translating natural language inputs into SQL query language.

1.3.5	Query Assist will only utilize data from Agoda Services to answer queries.

1.3.6	Query Assist will be integrated with Superset, Slack, and web-based platforms.

\section{Phases}
This project will be divided into three phases. The first phase focuses on error handling to ensure that we ultimately provide the correct query for the user. This includes correcting all syntax errors, accommodating syntax differences across databases, and fixing column names, table names, and typos in the query. The second phase focuses on optimizing the query such as using the partition column, decreasing memory consumption, and reducing the query execution time. The third and final phase aims to translate natural language into SQL query language.

\pagebreak

\section{Task and Schedule}
    \subsection{Semester 1}
    % \input{chapters/1/gantt_chart.tex}
    % \begin{table}[H]
    %     \centering
    %     \caption{Schedule of Semester 1}\label{tbl:schedule}
    %     \includegraphics[width=15cm]{chapters/1/figures/plan.png}
    % \end{table}
    \begin{figure}[ht]
      \centering
      \begin{tikzpicture}
        \matrix [
          matrix of nodes,
          nodes in empty cells,
          row sep=0.3em,
          column sep=1.5em,
          ampersand replacement=\&,
          every node/.style={font=\small, anchor=west}
        ] {
          \node [fill=AllColor, minimum width=0.7cm, minimum height=0.3cm]{}; \& All tasks \&
          \node[fill=ShayathipColor, minimum width=0.7cm, minimum height=0.3cm]{}; \& Shayathip's tasks \&
          \node[fill=RaminColor, minimum width=0.7cm, minimum height=0.3cm]{}; \& Ramin's tasks \\
        };
      \end{tikzpicture}

      \vspace{1em}
      \begin{ganttchart}[
        hgrid,
        vgrid,
        y unit chart=0.5cm,
        bar height=0.4,
        bar top shift=0.2,
        group height=0.3,
        group top shift=0.2,
        title/.append style={draw=none, fill=none},
        label node/.append style={align=left, text height=1.2ex, text depth=.25ex},
        group label font=\bfseries,
        title label font=\bfseries\footnotesize,
        bar/.append style={draw=black},
        milestone/.append style={fill=red}
      ]{1}{20}
        \gantttitlelist{1,...,20}{1} \\
        \ganttgroup{Phase 1}{1}{14} \\
        \ganttbar[bar/.append style={fill=AllColor}]{Project Discussion}{1}{1} \\
        \ganttbar[bar/.append style={fill=AllColor}, inline=false]{Idea Generation}{2}{2} \\
        \ganttbar[bar/.append style={fill=AllColor}, inline=false]{Brainstorming}{2}{3} \\
        \ganttbar[bar/.append style={fill=AllColor}, inline=false]{System Design}{3}{3} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Project Setup}{4}{4} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Table API Sequence Diagram}{4}{4} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Build Table API}{5}{6} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Query Tool Diagram}{4}{4} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Build Query Tools}{5}{6} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Merge \& Debug}{7}{7} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Tune \& Monitor}{8}{9} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{CI/CD \& Deploy}{9}{9} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Slack Integration}{10}{11} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Slack Tracking \& MVP}{12}{14} \\
        \ganttgroup{Phase 1.5}{14}{15} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Merge Database V1/V2}{14}{15} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Merge Code V1/V2}{14}{15} \\
        \ganttgroup{Phase 2}{16}{20} \\
        \ganttbar[bar/.append style={fill=AllColor}, inline=false]{Phase 2 Design/POC}{16}{17} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Build Optimizer}{18}{20}
      \end{ganttchart}
    \end{figure}

\clearpage
    \textbf{Task breakdown}
    \begin{table}[H]
        \centering
        \caption{Task Breakdown for Query Assist Project Semester 1}
        \label{tbl:task-breakdown-first-semester}
        \begin{tabular}{|p{4cm}|p{10cm}|}
            \hline
            \textbf{Task} & \textbf{Description} \\
            \hline
            Project Discussion & Discuss the problem and scope of the project with the team in the company. \\
            \hline
            Idea Generation & Research about the solution of the problem and study about LLMs. \\
            \hline
            Brainstorming & Gather ideas and brainstorming for one final solution. \\
            \hline
            System Design & Drawing architecture diagram, sequence diagram, and use-case diagram of the Query Assist. \\
            \hline
            Project Setup & Initiate the base structure code of the Query Assist project. \\
            \hline
            Table API Sequence Diagram & Draw the sequence diagram for an API route to update information of tables and columns for Query Assist. \\
            \hline
            Build Table API & Implement the API route to update the tables and columns data following the metadata in OpenMetadata. \\
            \hline
            Query Tool Diagram & Draw sequence diagrams for tools that agents use. \\
            \hline
            Build Query Tools & Code custom functions for agents to use as tools to handle query problems. \\
            \hline
            Merge \& Debug & Merge the Query Assist and API update functionalities. Debug the merged code. \\
            \hline
            Tune \& Monitor & Perform prompt tuning and monitoring to find practical prompts that solve query-related problems effectively. \\
            \hline
            CI/CD \& Deploy & Implement CI/CD for the project using GitLab CI and deploy the Minimum Viable Product (MVP) for team testing. \\
            \hline
            Slack Integration & Integrate Query Assist with Slack to optimize ticket handling and reduce time usage. \\
            \hline
            Slack Tracking \& MVP & Implement performance tracking for Query Assist via Slack bot. Monitor and enhance error handling over time. \\
            \hline
            Merge Database V1/V2 & Merge the new Query Assist database with the old version and test its usability. \\
            \hline
            Merge Code V1/V2 & Merge the new Query Assist code with the old version and test its usability. \\
            \hline
            Phase 2 Design/POC & Research and design the approach for optimization handling in Query Assist's second phase. \\
            \hline
            Build Optimizer & Implement the optimization feature into Query Assist. \\
            \hline
        \end{tabular}
    \end{table}
\pagebreak
    \subsection{Semester 2}
    \begin{figure}[ht]
      \centering
      \begin{tikzpicture}
        \matrix [
          matrix of nodes,
          nodes in empty cells,
          row sep=0.3em,
          column sep=1.5em,
          ampersand replacement=\&,
          every node/.style={font=\small, anchor=west}
        ] {
          \node [fill=AllColor, minimum width=0.7cm, minimum height=0.3cm]{}; \& All tasks \&
          \node[fill=ShayathipColor, minimum width=0.7cm, minimum height=0.3cm]{}; \& Shayathip's tasks \&
          \node[fill=RaminColor, minimum width=0.7cm, minimum height=0.3cm]{}; \& Ramin's tasks \\
        };
      \end{tikzpicture}

      \vspace{1em}
      \begin{ganttchart}[
        hgrid,
        vgrid,
        y unit chart=0.5cm,
        bar height=0.4,
        bar top shift=0.2,
        group height=0.3,
        group top shift=0.2,
        title/.append style={draw=none, fill=none},
        label node/.append style={align=left, text height=1.2ex, text depth=.25ex},
        group label font=\bfseries,
        title label font=\bfseries\footnotesize,
        bar/.append style={draw=black},
        milestone/.append style={fill=red}
      ]{1}{20}
        \gantttitlelist{1,...,20}{1} \\
        \ganttgroup{Phase 2}{1}{8} \\
        \ganttbar[bar/.append style={fill=AllColor}]{POC Generating Feature}{1}{3} \\
        \ganttbar[bar/.append style={fill=AllColor}, inline=false]{Evaluate \& Merge Models}{4}{5} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Improve Phase 1}{4}{4} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Superset + Deploy MVC}{5}{6} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Feedback \& Enhance}{7}{8} \\
        \ganttgroup{Phase 3}{9}{20} \\
        \ganttbar[bar/.append style={fill=AllColor}, inline=false]{POC \& Design Optimization}{9}{10} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Implement Optimization}{10}{11} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Prompt Tuning \& Monitor}{12}{13} \\
        \ganttbar[bar/.append style={fill=RaminColor}, inline=false]{Feedback \& Enhance}{14}{15}
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{}{16}{17} \\
        \ganttbar[bar/.append style={fill=ShayathipColor}, inline=false]{Finalize Project}{18}{20}
      \end{ganttchart}
    \end{figure}
    \textbf{Task breakdown}
    \begin{table}[!h]
        \centering
        \caption{Task Breakdown for Query Assist Project Semester 2}
        \label{tbl:task-breakdown-second-semester}
        \begin{tabular}{|p{4cm}|p{10cm}|}
            \hline
            \textbf{Task} & \textbf{Description} \\
            \hline
            POC Generating Feature & Research and design the approach for constructing queries from the natural language feature of Query Assist. \\
            \hline
            Evaluate \& Merge Models & Evaluate the effectiveness of each solution and integrate them into a single comprehensive model. \\
            \hline
            Improve Phase 1 & Improve the first phase that has been launched based on feedback and its performance. \\
            \hline
            Superset + Deploy MVC & Integrate Query Assist into Superset and deploy this version. \\
            \hline
            Feedback \& Enhance & Get feedback from users and enhance project quality. \\
            \hline
            POC \& Design Optimization feature & Implement optimization features into Query Assist. \\
            \hline
            Implement Optimization & Tune prompts and monitor results for optimization features. \\
            \hline
            Prompt Tuning \& Monitor & Tune prompts and monitor results for optimization features. \\
            \hline
            Feedback \& Enhance & Get feedback from users and enhance project quality. \\
            \hline
            Finalize Project & Finalize the project and wrap up. \\
            \hline
        \end{tabular}
    \end{table}
\pagebreak

\section{Expected Outcomes}
The end goal of the project is to develop a comprehensive Query Assist tool that enables users to efficiently retrieve and manage data without needing SQL expertise. Key features include automated error correction, performance optimization, and the ability to translate natural language into SQL queries, all integrated into platforms like Slack and Superset, fostering enhanced data access and decision-making capabilities.

\textbf{Semester 1}
\begin{itemize}
    \item  Overall system design
    \begin{itemize}
        \item Architecture Design
        \item Use Case Diagram
        \item Sequence Diagram
        \item Flow Chart
    \end{itemize}

    \item  Query Assist Phase 1
    \begin{itemize}
        \item Correcting all syntax errors
        \item Accommodating syntax differences across databases
        \item Fixing typos in column names, and table names
    \end{itemize}

    \item  Integrate into Slack
    \item Deploy MVC (Minimum viable product)
\end{itemize}
\textbf{Semester 2}
\begin{itemize}
    \item  Performance Metrics

    \item  Query Assist Phase 2
    \begin{itemize}
        \item Translate natural language to SQL query
    \end{itemize}

    \item Query Assist Phase 3
    \begin{itemize}
        \item Auto add partition column
        \item Decreasing memory consumption
        \item Reducing the query execution time
    \end{itemize}
\end{itemize}
\pagebreak
